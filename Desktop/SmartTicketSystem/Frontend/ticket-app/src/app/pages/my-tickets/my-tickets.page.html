<div class="page">
  <div class="header">
    <h1>My Tickets</h1>
    <button mat-raised-button color="primary" routerLink="/tickets/create">
      <mat-icon>add</mat-icon>
      Create New Ticket
    </button>
  </div>

  <app-loading *ngIf="loading"></app-loading>

  <!-- No tickets message -->
  <mat-card *ngIf="!loading && tickets.length === 0">
    <mat-card-content style="text-align: center; padding: 3rem;">
      <mat-icon style="font-size: 64px; height: 64px; width: 64px; color: #ccc;">
        confirmation_number
      </mat-icon>
      <h2>No Tickets Yet</h2>
      <p>You haven't created any support tickets.</p>
      <button mat-raised-button color="primary" routerLink="/tickets/create">
        <mat-icon>add</mat-icon>
        Create Your First Ticket
      </button>
    </mat-card-content>
  </mat-card>

  <!-- Tickets List -->
  <div *ngIf="!loading && tickets.length > 0">
    <mat-card *ngFor="let ticket of tickets" class="ticket-card">
      <mat-card-header>
        <div class="ticket-header">
          <div class="ticket-info">
            <h2>
              <a [routerLink]="['/tickets', ticket.id]">{{ ticket.title }}</a>
            </h2>
            <p class="ticket-id">Ticket #{{ ticket.id }}</p>
          </div>
          <div class="ticket-badges">
            <app-priority-badge [priority]="ticket.priority"></app-priority-badge>
            <app-status-badge [status]="ticket.status"></app-status-badge>
          </div>
        </div>
      </mat-card-header>

      <mat-card-content>
        <!-- Status Timeline/Progress -->
        <div class="status-timeline">
          <div class="timeline-item" [class.active]="ticket.status === 'Created' || ticket.status === 'Assigned' || ticket.status === 'InProgress' || ticket.status === 'Resolved' || ticket.status === 'Closed'">
            <mat-icon [style.color]="getStatusColor('Created')">fiber_new</mat-icon>
            <span>Created</span>
          </div>
          <div class="timeline-line" [class.active]="ticket.status !== 'Created'"></div>
          
          <div class="timeline-item" [class.active]="ticket.status === 'Assigned' || ticket.status === 'InProgress' || ticket.status === 'Resolved' || ticket.status === 'Closed'">
            <mat-icon [style.color]="getStatusColor('Assigned')">assignment_ind</mat-icon>
            <span>Assigned</span>
          </div>
          <div class="timeline-line" [class.active]="ticket.status === 'InProgress' || ticket.status === 'Resolved' || ticket.status === 'Closed'"></div>
          
          <div class="timeline-item" [class.active]="ticket.status === 'InProgress' || ticket.status === 'Resolved' || ticket.status === 'Closed'">
            <mat-icon [style.color]="getStatusColor('InProgress')">hourglass_empty</mat-icon>
            <span>In Progress</span>
          </div>
          <div class="timeline-line" [class.active]="ticket.status === 'Resolved' || ticket.status === 'Closed'"></div>
          
          <div class="timeline-item" [class.active]="ticket.status === 'Resolved' || ticket.status === 'Closed'">
            <mat-icon [style.color]="getStatusColor('Resolved')">check_circle</mat-icon>
            <span>Resolved</span>
          </div>
          <div class="timeline-line" [class.active]="ticket.status === 'Closed'"></div>
          
          <div class="timeline-item" [class.active]="ticket.status === 'Closed'">
            <mat-icon [style.color]="getStatusColor('Closed')">lock</mat-icon>
            <span>Closed</span>
          </div>
        </div>

        <!-- Status Message -->
        <div class="status-message">
          <mat-icon [style.color]="getStatusColor(ticket.status)">
            {{ getStatusIcon(ticket.status) }}
          </mat-icon>
          <p>{{ getStatusMessage(ticket) }}</p>
        </div>

        <!-- Ticket Details -->
        <div class="ticket-details">
          <div class="detail-item">
            <mat-icon>category</mat-icon>
            <span>{{ ticket.categoryName }}</span>
          </div>
          <div class="detail-item" *ngIf="ticket.assignedToName">
            <mat-icon>person</mat-icon>
            <span>Assigned to: {{ ticket.assignedToName }}</span>
          </div>
          <div class="detail-item">
            <mat-icon>schedule</mat-icon>
            <span>Created: {{ ticket.createdAt | date:'medium' }}</span>
          </div>
          <div class="detail-item" *ngIf="ticket.updatedAt">
            <mat-icon>update</mat-icon>
            <span>Last Updated: {{ ticket.updatedAt | date:'medium' }}</span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button color="primary" [routerLink]="['/tickets', ticket.id]">
          <mat-icon>visibility</mat-icon>
          View Details
        </button>
        <span class="spacer"></span>
        <mat-chip *ngIf="ticket.commentCount > 0">
          <mat-icon>comment</mat-icon>
          {{ ticket.commentCount }} {{ ticket.commentCount === 1 ? 'comment' : 'comments' }}
        </mat-chip>
      </mat-card-actions>
    </mat-card>
  </div>
</div>